<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ristsõna mäng</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap');
        body {
            font-family: "Nunito", sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-style: normal;
            font-size: 3.5rem;
        }
        input {
            width: 6rem;
            height: 6rem;
            font-size: 3rem;
            text-align: center;
            background-color: #DEEFF5;
            outline: none;
            box-shadow: 0 0 3px 3px #000000;
        }
    </style>
</head>
<body>
<p class="text-[2.2rem] max-w-[50rem] text-center m-auto my-[6rem]">
    Lahenda ristsõna ja saad teada, milline nähtus on sügisele iseloomulik.
</p>
<div class="grid gap-1 grid-flow-row grid-cols-[repeat(10,6rem)] place-content-center">
    <div class="grid grid-cols-subgrid col-span-4">
        <img src="img/Poni.png" class="self-end w-[6rem] h-[6rem] col-start-4" />
    </div>
    <div class="grid grid-cols-subgrid col-span-6">
        <input class="bg-[#cdd4f7]" data-answer="P"  data-final-answer="true" data-correct="false"/>
        <input data-answer="O" data-correct="false"/>
        <input data-answer="N" data-correct="false"/>
        <input data-answer="I" data-correct="false"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-3">
        <img src="img/Paprika.png" class="self-end w-[6rem] h-[6rem] col-start-3"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-7">
        <input data-answer="P" data-correct="false"/>
        <input class="bg-[#cdd4f7]" data-answer="A" data-final-answer="true" data-correct="false"/>
        <input data-answer="P" data-correct="false"/>
        <input data-answer="R" data-correct="false"/>
        <input data-answer="I" data-correct="false"/>
        <input data-answer="K" data-correct="false"/>
        <input data-answer="A" data-correct="false"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-1">
        <img src="img/Voodi.png" class="self-end w-[6rem] h-[6rem] col-start-1"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-9">
        <input data-answer="V" data-correct="false"/>
        <input data-answer="O" data-correct="false"/>
        <input data-answer="O" data-correct="false"/>
        <input class="bg-[#cdd4f7]" data-answer="D" data-final-answer="true" data-correct="false"/>
        <input data-answer="I" data-correct="false"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-1">
        <img src="img/Tibu.png" class="self-end w-[6rem] h-[6rem] col-start-1"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-9">
        <input data-answer="T" data-correct="false"/>
        <input data-answer="I" data-correct="false"/>
        <input data-answer="B" data-correct="false"/>
        <input class="bg-[#cdd4f7]" data-answer="U" data-final-answer="true" data-correct="false"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-2">
        <img src="img/Kivi.png" class="self-end w-[6rem] h-[6rem] col-start-2"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-8">
        <input data-answer="K" data-correct="false"/>
        <input data-answer="I" data-correct="false"/>
        <input class="bg-[#cdd4f7]" data-answer="V" data-final-answer="true" data-correct="false"/>
        <input data-answer="I" data-correct="false"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-2">
        <img src="img/Leib.png" class="self-end w-[6rem] h-[6rem] col-start-2"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-8">
        <input data-answer="L" data-correct="false"/>
        <input data-answer="E" data-correct="false"/>
        <input class="bg-[#cdd4f7]" data-answer="I" data-final-answer="true" data-correct="false"/>
        <input data-answer="B" data-correct="false"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-2">
        <img src="img/Kahvel.png" class="self-end w-[6rem] h-[6rem] col-start-2"/>
    </div>
    <div class="grid grid-cols-subgrid col-span-8">
        <input data-answer="K" data-correct="false"/>
        <input data-answer="A" data-correct="false"/>
        <input class="bg-[#cdd4f7]" data-answer="H" data-final-answer="true" data-correct="false"/>
        <input data-answer="V" data-correct="false"/>
        <input data-answer="E" data-correct="false"/>
        <input data-answer="L" data-correct="false"/>
    </div>
    <img src="img/Raamat.png" class="self-end w-[6rem] h-[6rem]"/>
    <div class="grid grid-cols-subgrid col-span-9">
        <input data-answer="R" data-correct="false"/>
        <input data-answer="A" data-correct="false"/>
        <input data-answer="A" data-correct="false"/>
        <input class="bg-[#cdd4f7]" data-answer="M" data-final-answer="true" data-correct="false"/>
        <input data-answer="A" data-correct="false"/>
        <input data-answer="T" data-correct="false"/>
    </div>
</div>
<p class="p-6">
</p>
<div class="text-center hidden" id="winning-container">
    <h1 class="text-3xl">Tegid ära!</h1>
    <button
            class="border border-gray-400 rounded m-4 p-4 bg-gray-200 text-2xl"
            id="retry"
    >
        Alusta uuesti
    </button>
</div>
<script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
<script>
    let gameFinished = false;
    document.querySelectorAll("input").forEach((input) => {
        input.addEventListener("input", validateInput);
        input.addEventListener("input", validateFinalAnswer);
        input.addEventListener('keydown', handleBackspaceNavigation);
    });

    function doNotMoveCursor() {}

    function handleBackspaceNavigation(event) {
        const currentInput = event.target;

        if (event.key === 'Backspace' && currentInput.value === '') {
            const allInputs = Array.from(document.querySelectorAll("input"));
            const currentIndex = allInputs.indexOf(currentInput);
            allInputs[currentIndex - 1].focus();
        }
    }

    function validateInput(event) {
        event.target.value = event.target.value.slice(-1).toUpperCase();
        is_correct = event.target.value == event.target.dataset.answer;
        if (is_correct) {
            event.target.setAttribute("data-correct", "true");
        } else if (event.target.value) {
            event.target.setAttribute("data-correct", "false");
        }

        if (event.target.value === "") {
            return doNotMoveCursor();
        }

        const inputs = Array.from(document.querySelectorAll("input"));
        const currentIndex = inputs.indexOf(event.target);
        if (currentIndex < inputs.length - 1) {
            inputs[currentIndex + 1].focus();
        }
    }

    function validateFinalAnswer() {
        const inputs = Array.from(
            document.querySelectorAll('[data-final-answer]'));

        const correctLetters = inputs.filter((element) => {
            return element.getAttribute("data-correct") == "true";
        });

        if (correctLetters.length === inputs.length && gameFinished === false) {
            finishGame(correctLetters);
        }
    }

    function finishGame(answer) {
        gameFinished = true;
        answer.forEach(
            (element) => {
                element.classList.remove("bg-[#ebfaa7]");
                element.classList.add("bg-[#22c55e]");
            }
        );

        interval = setInterval(() => {
            confetti({
                angle: randomInRange(55, 125),
                spread: randomInRange(50, 70),
                particleCount: randomInRange(50, 100),
                origin: { y: 0.6 },
            });
        }, 300);

        setTimeout(() => {
            clearInterval(interval);
        }, 2000);

        document
            .getElementById("winning-container")
            .classList.remove("hidden");
    }

    function randomInRange(min, max) {
        return Math.random() * (max - min) + min;
    }

    document
        .getElementById("retry")
        .addEventListener("click", function () {
            location.reload(true);
        });
</script>
</body>
</html>
